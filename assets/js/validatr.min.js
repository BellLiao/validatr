/*! Validatr - v0.1.2 - 2013-02-14
* https://github.com/jaymorrow/validatr
* Copyright (c) 2013 Jay Morrow; Licensed MIT */
(function(e,t,n,r){"use strict";function E(e,t){this.el=e,this.$el=n(e);if(!this.$el.length||!this.$el.is("form"))throw new Error(v+" needs a form to work.");this.isSubmit=!1,this.firstError=!1,this.options=n.extend({},n.fn[v].defualtOptions,t),this.options.template=n(this.options.template).addClass(m.base+m[this.options.theme])[0].outerHTML,this.elements=this.getElements(this.el).on("valid."+v,n.proxy(M,this)).on("invalid."+v,n.proxy(O,this)),this.el.noValidate=!0,this.$el.on("submit."+v,n.proxy(L,this)),this.$el.on("reset."+v,n.proxy(A,this))}function S(){this.elements.on({"focus.validatrelement":T,"blur.validatrelement":N}),n("input[type=radio], input[type=checkbox]").on("click.validatrelement",function(e){C(e.target)})}function x(){this.elements.off(".validatrelement")}function T(e){var t=e.target,r=t;t.nodeName.toLowerCase()==="select"&&r.on("change.validatrinput",function(){setTimeout(function(){C(t)},1)}),n(t).on({"blur.validatrinput":function(){C(t)},"keyup.validatrinput":function(e){t.value.length&&f(a,e.keyCode)===-1&&C(t)}})}function N(e){n(e.target).off(".validatrinput")}function C(e){if(e.type==="radio"){var r=n(t.getElementsByName(e.name)).filter("[required]");r.length&&(e=r[0])}var a=n(e),f=e.getAttribute("type"),l=i.attributes.required?e.required:n(e).is("[required]"),c={valid:!0};if(i.inputtypes[f]&&e.checkValidity){c.valid=e.checkValidity();if(!c.valid)return!1}else l&&(c=o.required(e)),c.valid&&e.value.length&&!s.boxes.test(f)&&(e.pattern&&(f="pattern"),o[f]&&(c=o[f](e)));if(c.valid)for(var h in u)if(u.hasOwnProperty(h)&&a.data(h)){c=u[h](e);if(!c.valid)break}return c.valid?(a.trigger("valid"),!0):(n.data(e,"validationMessage",c.message),a.trigger("invalid"),!1)}function k(e){var t=!0;return e.each(function(e,n){C(n)||(t=!1)}),t}function L(){this.isSubmit=!0,A.call(this);var e=k(this.elements);return e?this.options.valid.call(this.el,this.el):(S.call(this),this.isSubmit=!1,e)}function A(){x.call(this),this.firstError=!1,this.elements.next(".validatr-message").remove()}function O(e){if(y)return;e.preventDefault();var t=e.target,r=n(t),i=t.validationMessage||n.data(t,"validationMessage"),s=this.options,o=n(s.template.replace("{{message}}",i));if(this.isSubmit&&!this.firstError){this.firstError=r.after(o),s.position.call(this,o,r);return}if(!this.isSubmit||s.showall)M(e),r.after(o),s.position.call(this,o,r)}function M(e){n(e.target).next(".validatr-message").remove()}function _(e,t){e.css("position","absolute");var n=t.offset(),r=t.data("location")||this.options.location;s.topbottom.test(r)?(e.offset({left:n.left}),r==="top"&&e.offset({top:n.top-e.outerHeight()-2}),r==="bottom"&&e.offset({top:n.top+e.outerHeight()})):s.leftright.test(r)&&(e.offset({top:n.top+t.outerHeight()/2-e.outerHeight()/2}),r==="left"&&e.offset({left:n.left-e.outerWidth()-2}),r==="right"&&e.offset({left:n.left+t.outerWidth()+2}))}var i=function(){var e={},n=t.documentElement,i=":)",s=t.createElement("input"),o={};return e.attributes={multiple:"multiple"in s,required:"required"in s},e.inputtypes=function(e){for(var u=0,a,f,l,c=e.length;u<c;u++)s.setAttribute("type",f=e[u]),a=s.type!=="text",a&&(s.value=i,s.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&s.style.WebkitAppearance!==r?(n.appendChild(s),l=t.defaultView,a=l.getComputedStyle&&l.getComputedStyle(s,null).WebkitAppearance!=="textfield"&&s.offsetHeight!==0,n.removeChild(s)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?a=s.checkValidity&&s.checkValidity()===!1:a=s.value!==i)),o[e[u]]=!!a;return o.text=!0,o.password=!0,o}("search tel url email datetime date month week time datetime-local number range color".split(" ")),s=null,e}(),s={boxes:/checkbox|radio/i,color:/^#[0-9A-F]{6}$/i,date:{dd:"(0[1-9]|[12][0-9]|3[01])",mm:"(0[1-9]|1[012])",yyyy:"(\\d{4})"},email:/^[a-zA-Z0-9.!#$%&â€™*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/,isoDate:/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,leftright:/left|right/i,separators:/(\/|\-|\.)/g,separatorsNoGroup:/\/|\-|\./g,time:/^([01][0-9]|2[0-3])(:([0-5][0-9])){2}$/,topbottom:/top|bottom/i,url:/^\s*https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?\s*$/},o={checkbox:function(e){return{valid:e.checked,message:"Please check this box if you want to proceed."}},color:function(e){return{valid:s.color.test(e.value),message:"Please enter a color in the format #xxxxxx"}},date:function(e){var t=n(e),r=i.inputtypes.date?c(e.value):l(e),s=t.attr("min")?c(t.attr("min")):!1,o=t.attr("max")?c(t.attr("max")):!1,u=isNaN(t.attr("step"))?!1:parseInt(t.attr("step"),10);return p.call(e,r,s,o,u,"date")},email:function(e){var t=!0,r="Please enter an email address.",o=i.attributes.multiple?e.multiple:n(e).is("[multiple]");if(o){var u=e.value.split(",");n.each(u,function(e,n){if(!s.email.test(n)){t=!1,r="Please enter a comma separated list of email addresses.";return}})}else t=s.email.test(e.value);return{valid:t,message:r}},number:function(e){var t=n(e),r=isNaN(parseFloat(e.value))?!1:parseFloat(e.value),i=r!==!1?isNaN(t.attr("min"))?!1:parseFloat(t.attr("min")):!1,s=r!==!1?isNaN(t.attr("max"))?!1:parseFloat(t.attr("max")):!1,o=r!==!1?isNaN(t.attr("step"))?!1:parseFloat(t.attr("step")):!1;return o!==!1&&i===!1&&(i=0),p.call(e,r,i,s,o,"number")},pattern:function(e){return{valid:(new RegExp(e.pattern)).test(e.value),message:"Please match the requested format."}},radio:function(e){return{valid:n(t.getElementsByName(e.name)).is(":checked"),message:"Please select one of these options."}},range:function(e){return this.number(e)},required:function(e){return s.boxes.test(e.type)?this[e.type](e):{valid:e.value.length,message:e.nodeName.toLowerCase()==="select"?"Please select an item in the list.":"Please fill out this field."}},time:function(e){return{valid:s.time.test(e.value),message:"Please enter a time in the format hh:mm:ss"}},url:function(e){return{valid:s.url.test(e.value),message:"Please enter a url."}}},u={as:function(e){if(e.type!=="text")throw new Error("element must have a type of text");var t=n(e).data("as");if(o[t])return o[t](e)},match:function(e){var r=n(e).data("match"),i=t.getElementById(r)||t.getElementsByName(r)[0];return i?(n(i).off("valid.validatrinput").on("valid.validatrinput",function(){e.value===i.value&&C(e)}),{valid:e.value===i.value,message:"'"+e.name+"' does not equal '"+i.name+"'"}):{valid:!1,message:"'"+r+"' can not be found"}}},a=[16,17,18,19,20,33,34,35,36,37,39],f=function(e,t){var n=-1,r=e?e.length:0;while(++n<r)if(e[n]===t)return n;return-1},l=function(e){var t=n(e).data("format")||n[v].dateFormat,r=t.split(s.separatorsNoGroup),i=e.value.split(s.separatorsNoGroup),o="yyyy-mm-dd".split("-"),u=t.replace(s.separators,"\\$1").replace("yyyy",s.date.yyyy).replace("mm",s.date.mm).replace("dd",s.date.dd),a=-1,l=o.length,h=[];u=new RegExp(u);if(!u.test(e.value))return!1;while(++a<l)h[a]=i[f(r,o[a])];return c(h.join("-"))},c=function(e){if(!s.isoDate.test(e))return!1;var t=s.isoDate.exec(e);return new Date(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10))},h=function(e,t){var r=e.getDate(),i=e.getMonth()+1,s=e.getFullYear(),o=(n(t).data("format")||n[v].dateFormat).replace("mm",i).replace("yyyy",s).replace("dd",r);return o},p=function(e,t,n,r,i){var s=!0,o="Please enter a "+i,u=t,a=n;return i==="date"&&(u=t&&h(t,this),a=n&&h(n,this)),e!==!1&&(t!==!1&&n!==!1?(s=e>=t&&e<=n,o="Please enter a "+i+" greater than or equal to "+u+"<br /> and less than or equal to "+a+"."):t!==!1?(s=e>=t,o="Please enter a "+i+" greater than or equal to "+u+"."):n!==!1&&(s=e<=n,o="Please enter a "+i+" less than or equal to "+a+"."),s&&r!==!1&&(s=(e-t)%r===0,o="Invalid "+i)),{valid:e!==!1&&s,message:o}},d=function(e){return e instanceof jQuery&&(e=e[0]),e},v="validatr",m={base:v+"-message ",bootstrap:"alert alert-error",jqueryui:"ui-state-error ui-corner-all",none:v+"-error"},g="button, input[type=submit], input[type=button], input[type=reset]",y=!1,b="mm/dd/yyyy",w=function(){};w.prototype={dateFormat:b,addTest:function(e){var t=typeof e!="string",r=Array.prototype.slice.call(arguments,1)[0];t?n.extend(u,e):u[e]=r},getElements:function(e){if(this.elements)return this.elements;var t=n(e).map(function(){return this.elements?n.makeArray(this.elements):n.makeArray(n(this).find("input, textarea, select"))}).not(g);return e.id&&(t=t.add(n('[for="'+e.id+'"]'))),t},validateElement:function(e){if(!e)throw new Error("method requires an element");y=!0;var t=C(d(e));return y=!1,t},validateForm:function(e){var t=this.el||d(e),n;if(t.nodeName.toLowerCase()!=="form")throw new Error("you must pass a form to this method");return y=!0,n=k(this.elements||this.getElements(t)),y=!1,n}},n.fn[v]=function(e){var t=typeof e=="string",i=Array.prototype.slice.call(arguments,1),s=this,o;if(t)this.each(function(){var t;o=n.data(this,v);if(!o)throw new Error("cannot call methods on "+v+" prior to initialization; attempted to call method '"+e+"'");if(!n.isFunction(o[e]))throw new Error("no such method '"+e+"' for "+v+" widget instance");t=o[e].apply(o,i);if(t!==o&&t!==r)return s=t&&t.jquery?s.pushStack(t.get()):t,!1});else{var u;this.each(function(){o=n.data(this,v),o||(u=new w,E.call(u,this,e||{}),n.data(this,v,u))})}return s},n.fn[v].defualtOptions={showall:!1,location:"right",position:_,template:"<div>{{message}}</div>",theme:"none",valid:n.noop},n[v]=new w,n.expr[":"][v]=function(e){return e.textContent.indexOf(v)>=0}})(this,this.document,jQuery);
