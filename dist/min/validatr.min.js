/*! Validatr - v0.3.2 - 2013-02-23
* http://jaymorrow.github.com/validatr/
* Copyright (c) 2013 Jay Morrow; Licensed MIT */
(function(e,t,a,r){"use strict";function i(e,t){if(this.el=e,this.$el=a(e),!this.$el.length||!this.$el.is("form"))throw Error("validatr needs a form to work.");this.isSubmit=!1,this.firstError=!1,this.options=a.extend({},a.fn.validatr.defualtOptions,t),this.options.template=a(this.options.template).addClass($.base+$[this.options.theme])[0].outerHTML,this.elements=this.getElements(this.el).on("valid.validatr",a.proxy(f,this)).on("invalid.validatr",a.proxy(p,this)),this.el.noValidate=!0,this.$el.on("submit.validatr",a.proxy(m,this)),this.$el.on("reset.validatr",a.proxy(c,this))}function s(){this.elements.on({"focus.validatrelement":l,"blur.validatrelement":o}),a("input[type=radio], input[type=checkbox]").on("click.validatrelement",function(e){u(e.target)})}function n(){this.elements.off(".validatrelement")}function l(e){var t=e.target,r=t;"select"===t.nodeName.toLowerCase()&&r.on("change.validatrinput",function(){setTimeout(function(){u(t)},1)}),a(t).on({"blur.validatrinput":function(){u(t)},"keyup.validatrinput":function(e){t.value.length&&-1===w(x,e.keyCode)&&u(t)}})}function o(e){a(e.target).off(".validatrinput")}function u(e){if("radio"===e.type){var r=a(t.getElementsByName(e.name)).filter("[required]");r.length&&(e=r[0])}var i=a(e),s=g.notInput.test(e.nodeName)?e.nodeName.toLowerCase():e.getAttribute("type"),n=v.attributes.required?e.required:a(e).is("[required]"),l={valid:!0,message:""};if(v.inputtypes[s]?(l.valid=e.validity.valid,l.message=e.validationMessage):(n&&(l=y.required(e)),l.valid&&e.value.length&&!g.boxes.test(s)&&(e.pattern&&(s="pattern"),y[s]&&(l=y[s](e)))),l.valid)for(var o in b)if(b.hasOwnProperty(o)&&i.is("[data-"+o+"]")&&(l=b[o](e),!l.valid))break;return l.valid?(i.trigger("valid"),!0):(a.data(e,"validationMessage",l.message),i.trigger("invalid"),!1)}function d(e){var t=!0;return e.each(function(e,a){u(a)||(t=!1)}),t}function m(){this.isSubmit=!0,c.call(this);var e=d(this.elements);return e?this.options.valid.call(this.el,this.el):(s.call(this),this.isSubmit=!1,e)}function c(){n.call(this),this.firstError=!1,this.elements.next(".validatr-message").remove()}function p(e){if(!C){e.preventDefault();var t=e.target,i=a(t),s=this.options,n=t.getAttribute("data-message")||a.data(t,"validationMessage"),l=a(s.template.replace("{{message}}",n));return this.isSubmit&&!this.firstError?(this.firstError=i.after(l),s.position.call(this,l,i),r):((!this.isSubmit||s.showall)&&(f(e),i.after(l),s.position.call(this,l,i)),r)}}function f(e){C||a(e.target).next(".validatr-message").remove()}function h(e,t){e.css("position","absolute");var a=t.offset(),r=t[0].getAttribute("data-location")||this.options.location;g.topbottom.test(r)?(e.offset({left:a.left}),"top"===r&&e.offset({top:a.top-e.outerHeight()-2}),"bottom"===r&&e.offset({top:a.top+e.outerHeight()})):g.leftright.test(r)&&(e.offset({top:a.top+t.outerHeight()/2-e.outerHeight()/2}),"left"===r&&e.offset({left:a.left-e.outerWidth()-2}),"right"===r&&e.offset({left:a.left+t.outerWidth()+2}))}var v=function(){var e={},a=t.documentElement,i=":)",s=t.createElement("input"),n=t.createElement("select"),l=t.createElement("textarea"),o={};return e.attributes={multiple:!!("multiple"in s),required:!!("required"in s)},e.inputtypes=function(e){a.appendChild(s);for(var n,l,u,d=0,m=e.length;m>d;d++)s.setAttribute("type",l=e[d]),n="text"!==s.type,n&&(s.value=i,s.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(l)&&s.style.WebkitAppearance!==r?(u=t.defaultView,n=u.getComputedStyle&&"textfield"!==u.getComputedStyle(s,null).WebkitAppearance&&0!==s.offsetHeight):/^search|tel$/.test(l)||(n=/^url|email$/.test(l)?s.checkValidity&&s.checkValidity()===!1:/^checkbox|radio|password$/.test(l)?s.checkValidity:s.value!==i)),"text"===e[d]&&(n=s.checkValidity),o[e[d]]=!!n;return a.removeChild(s),o}("text search tel url email datetime date month week time datetime-local number range color password checkbox radio".split(" ")),e.inputtypes.select=!!n.checkValidity,e.inputtypes.textarea=!!l.checkValidity,s=null,n=null,l=null,e}(),g={boxes:/checkbox|radio/i,color:/^#[0-9A-F]{6}$/i,date:{dd:"(0[1-9]|[12][0-9]|3[01])",mm:"(0[1-9]|1[012])",yyyy:"(\\d{4})"},email:/^[a-zA-Z0-9.!#$%&â€™*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/,isoDate:/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,leftright:/left|right/i,notInput:/select|textarea/i,separators:/(\/|\-|\.)/g,separatorsNoGroup:/\/|\-|\./g,time:/^([01][0-9]|2[0-3])(:([0-5][0-9])){2}$/,topbottom:/top|bottom/i,url:/^\s*https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?\s*$/},y={checkbox:function(e){return{valid:e.checked,message:a.validatr.messages.checkbox}},color:function(e){return{valid:g.color.test(e.value),message:a.validatr.messages.color}},date:function(e){var t=a(e),r=v.inputtypes.date?E(e.value):k(e),i=t.attr("min")?E(t.attr("min")):!1,s=t.attr("max")?E(t.attr("max")):!1,n=isNaN(t.attr("step"))?!1:parseInt(t.attr("step"),10);return q.call(e,r,i,s,n,"date")},email:function(e){var t=!0,i=a.validatr.messages.email.single,s=v.attributes.multiple?e.multiple:a(e).is("[multiple]");if(s){var n=e.value.split(",");a.each(n,function(e,s){return g.email.test(s)?r:(t=!1,i=a.validatr.messages.email.multiple,r)})}else t=g.email.test(e.value);return{valid:t,message:i}},number:function(e){var t=a(e),r=isNaN(parseFloat(e.value))?!1:parseFloat(e.value),i=r!==!1?isNaN(t.attr("min"))?!1:parseFloat(t.attr("min")):!1,s=r!==!1?isNaN(t.attr("max"))?!1:parseFloat(t.attr("max")):!1,n=r!==!1?isNaN(t.attr("step"))?!1:parseFloat(t.attr("step")):!1;return n!==!1&&i===!1&&(i=0),q.call(e,r,i,s,n,"number")},pattern:function(e){return{valid:RegExp(e.pattern).test(e.value),message:a.validatr.messages.pattern}},radio:function(e){return{valid:a(t.getElementsByName(e.name)).is(":checked"),message:a.validatr.messages.radio}},range:function(e){return this.number(e)},required:function(e){return g.boxes.test(e.type)?this[e.type](e):{valid:!!e.value.length,message:"select"===e.nodeName.toLowerCase()?a.validatr.messages.select:a.validatr.messages.required}},time:function(e){return{valid:g.time.test(e.value),message:a.validatr.messages.time}},url:function(e){return{valid:g.url.test(e.value),message:a.validatr.messages.url}}},b={as:function(e){if("text"!==e.type)throw Error("element must have a type of text");var t=e.getAttribute("data-as");return y[t]?y[t](e):r},match:function(e){var r=e.getAttribute("data-match"),i=t.getElementById(r)||t.getElementsByName(r)[0];return i?(a(i).off("valid.validatrinput").on("valid.validatrinput",function(){e.value===i.value&&u(e)}),{valid:e.value===i.value,message:"'"+e.name+"' does not equal '"+i.name+"'"}):{valid:!1,message:"'"+r+"' can not be found"}}},x=[16,17,18,19,20,33,34,35,36,37,39],w=function(e,t){for(var a=-1,r=e?e.length:0;r>++a;)if(e[a]===t)return a;return-1},k=function(e){var t=e.getAttribute("data-format")||S,a=t.split(g.separatorsNoGroup),r=e.value.split(g.separatorsNoGroup),i="yyyy-mm-dd".split("-"),s=t.replace(g.separators,"\\$1").replace("yyyy",g.date.yyyy).replace("mm",g.date.mm).replace("dd",g.date.dd),n=-1,l=i.length,o=[];if(s=RegExp(s),!s.test(e.value))return!1;for(;l>++n;)o[n]=r[w(a,i[n])];return E(o.join("-"))},E=function(e){if(!g.isoDate.test(e))return!1;var t=g.isoDate.exec(e);return new Date(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10))},N=function(e,t){var a=e.getDate(),r=e.getMonth()+1,i=e.getFullYear(),s=(t.getAttribute("data-format")||S).replace("mm",r).replace("yyyy",i).replace("dd",a);return s},q=function(e,t,r,i,s){var n=!0,l=a.validatr.messages.range.base,o=t,u=r;return"date"===s&&(o=t&&N(t,this),u=r&&N(r,this)),e!==!1&&(t!==!1&&r!==!1?(n=e>=t&&r>=e,l=a.validatr.messages.range.overUnder):t!==!1?(n=e>=t,l=a.validatr.messages.range.overflow):r!==!1&&(n=r>=e,l=a.validatr.messages.range.underflow),n&&i!==!1&&(n=0===(e-t)%i,l=a.validatr.messages.range.invalid)),{valid:e!==!1&&n,message:l.replace("{{type}}",s).replace("{{min}}",o).replace("{{max}}",u)}},A=function(e){return e instanceof jQuery&&(e=e[0]),e},$={base:"validatr-message ",bootstrap:"alert alert-error",jqueryui:"ui-state-error ui-corner-all",none:"validatr-error"},P="button, input[type=submit], input[type=button], input[type=reset]",C=!1,S="mm/dd/yyyy",F=function(){};F.prototype={addTest:function(e){var t="string"!=typeof e,r=Array.prototype.slice.call(arguments,1)[0];if(t)a.extend(b,e);else{if(!r)throw Error("You must include a callback function");b[e]=r}},getElements:function(e){if(this.elements)return this.elements;var t=a(e).map(function(){return this.elements?a.makeArray(this.elements):a.makeArray(a(this).find("input, textarea, select"))}).not(P);return e.id&&(t=t.add(a('[for="'+e.id+'"]'))),t},validateElement:function(e){if(!e)throw Error("method requires an element");C=!0;var t=u(A(e));return C=!1,t},validateForm:function(e){var t,a=this.el||A(e);if("form"!==a.nodeName.toLowerCase())throw Error("you must pass a form to this method");return C=!0,t=d(this.elements||this.getElements(a)),C=!1,t}},a.fn.validatr=function(e){var t,s="string"==typeof e,n=Array.prototype.slice.call(arguments,1),l=this;if(s)this.each(function(){var i;if(t=a.data(this,"validatr"),!t)throw Error("cannot call methods on validatr prior to initialization; attempted to call method '"+e+"'");if(!a.isFunction(t[e]))throw Error("no such method '"+e+"' for validatr instance");return i=t[e].apply(t,n),i!==t&&i!==r?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):r});else{var o;this.each(function(){t=a.data(this,"validatr"),t||(o=new F,i.call(o,this,e||{}),a.data(this,"validatr",o))})}return l},a.fn.validatr.defualtOptions={customMessages:!1,location:"right",position:h,showall:!1,template:"<div>{{message}}</div>",theme:"none",valid:a.noop},a.validatr=new F,a.validatr.messages={checkbox:"Please check this box if you want to proceed.",color:"Please enter a color in the format #xxxxxx",email:{single:"Please enter an email address.",multiple:"Please enter a comma separated list of email addresses."},pattern:"Please match the requested format.",radio:"Please select one of these options.",range:{base:"Please enter a {{type}}",overflow:"Please enter a {{type}} greater than or equal to {{min}}.",overUnder:"Please enter a {{type}} greater than or equal to {{min}}<br> and less than or equal to {{max}}.",invalid:"Invalid {{type}}",underflow:"Please enter a {{type}} less than or equal to {{max}}."},required:"Please fill out this field.",select:"Please select an item in the list.",time:"Please enter a time in the format hh:mm:ss",url:"Please enter a url."},a.validatr.debug=function(){if(!QUnit)throw Error("QUnit is required for debugging");this.Support=v,this.Tests=y,this.CustomTests=b},a.expr[":"].validatr=function(e){return e.textContent.indexOf("validatr")>=0}})(this,this.document,jQuery);