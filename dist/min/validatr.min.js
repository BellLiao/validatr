/*! Validatr - v0.1.0 - 2013-02-09
* https://github.com/jaymorrow/validatr
* Copyright (c) 2013 Jay Morrow; Licensed MIT */
(function(e,t,n){"use strict";function d(e,n){this.el=e,this.$el=t(e);if(!this.$el.length||!this.$el.is("form"))throw new Error(o+" needs a form to work.");this.isSubmit=!1,this.firstError=null,this.options=t.extend({},t.fn[o].defualtOptions,n),this.options.template=t(this.options.template).addClass(u.base+u[this.options.theme])[0].outerHTML,this.elements=this.getElements(this.el).on("valid."+o,t.proxy(x,this)).on("invalid."+o,t.proxy(S,this)),this.options.event&&this.elements.on("blur."+o,t.proxy(E,this)),/key/i.test(this.options.event)&&this.elements.on("focus."+o,t.proxy(w,this)),this.el.noValidate=!0,this.$el.on("submit."+o,t.proxy(m,this,this.elements)),this.$el.on("reset."+o,t.proxy(y,this))}function v(e){var n=e.getAttribute("type"),i=r.inputtypes[n],s=r.input.required?e.required:b(e),o=t(e).data("match"),u={},a=!0;return e.willValidate&&i?a=e.checkValidity():s&&!e.value.length?(u=c.required(e),a=u.valid):e.value.length&&(e.pattern&&(n="pattern"),c[n]?(u=c[n](e),a=u.valid):a=!0),a&&o&&(u=c.match(e,o),a=u.valid),a?(console.log(a),t(e).trigger("valid")):u.message&&(t.data(e,"validationMessage",u.message),t(e).trigger("invalid")),a}function m(e){this.isSubmit=!0,this.firstError=null,y.call(this);var t=g(e);return t?this.options.valid.call(this.el,this.el):(this.firstError.focus(),this.isSubmit=!1,this.firstError=null,t)}function g(e){var t=!0;return e.each(function(e,n){v(n)||(t=!1)}),t}function y(){this.$el.find(".validatr-message").remove()}function b(e){if(e.required)return e.required==="true";var t=e.attributes,n=t.length,r=0;for(r;r<n;r+=1)if(t[r].name==="required")return e.required="true",!0;return e.required="false",!1}function w(e){var n=e.target,r=t(n),s=this;r.on(this.options.event+"."+o,i(function(){n.value.length&&v(n)},this.options.delay))}function E(e){var n=e.target,r=t(n);r.off(this.options.event+"."+o),v(n)}function S(e){if(f)return;e.preventDefault();var n=e.target,r=t(n),i=n.validationMessage||t.data(n,"validationMessage"),s;if(!this.isSubmit||this.isSubmit&&!this.firstError)s=t(this.options.template.replace("{{message}}",i)),this.firstError=r[this.options.insert](s),this.options.position.call(this,s,r)}function x(e){t(e.target).next(".validatr-message").remove().end().prev(".validatr-message").remove()}function T(e,t){e.css("position","absolute");var n=t.offset();l.topbottom.test(this.options.location)?(e.offset({left:n.left}),this.options.location==="top"&&e.offset({top:n.top-e.outerHeight()-2}),this.options.location==="bottom"&&e.offset({top:n.top+e.outerHeight()})):l.leftright.test(this.options.location)&&(e.offset({top:n.top}),this.options.location==="left"&&e.offset({left:n.left-e.outerWidth()-2}),this.options.location==="right"&&e.offset({left:n.left+t.outerWidth()+2}))}var r=function(e,t,n){var r={},i=t.documentElement,s=":)",o=t.createElement("input"),u={},a={},f={};return r.input=function(n){for(var r=0,i=n.length;r<i;r++)f[n[r]]=n[r]in o;return f.list&&(f.list=!!t.createElement("datalist")&&!!e.HTMLDataListElement),f}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),r.inputtypes=function(e){for(var r=0,u,f,l,c=e.length;r<c;r++)o.setAttribute("type",f=e[r]),u=o.type!=="text",u&&(o.value=s,o.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&o.style.WebkitAppearance!==n?(i.appendChild(o),l=t.defaultView,u=l.getComputedStyle&&l.getComputedStyle(o,null).WebkitAppearance!=="textfield"&&o.offsetHeight!==0,i.removeChild(o)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?u=o.checkValidity&&o.checkValidity()===!1:u=o.value!==s)),a[e[r]]=!!u;return a.text=!0,a}("search tel url email datetime date month week time datetime-local number range color".split(" ")),o=null,r}(e,e.document),i=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},s=t.ui!==n,o="validatr",u={base:o+"-message ",bootstrap:"alert alert-error",jqueryui:"ui-state-error ui-corner-all",none:o+"-error"},a="button, input[type=submit], input[type=button], input[type=reset]",f=!1,l={color:/^#[0-9A-F]{6}$/i,date:/^(0[1-9]|1[012])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/,email:/^[a-zA-Z0-9.!#$%&â€™*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/,leftright:/left|right/i,time:/^([01][0-9]|2[0-3])(:([0-5][0-9])){2}$/,topbottom:/top|bottom/i,url:/https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/},c={color:function(e){return{valid:l.color.test(e.value),message:"Please enter a color in the format #xxxxxx"}},date:function(e){return{valid:l.date.test(e.value),message:"Please enter a date in the format mm/dd/yyyy"}},email:function(e){return{valid:l.email.test(e.value),message:"Please enter an email address."}},match:function(e,t){var n=document.getElementById(t)||document.getElementsByName(t)[0];return n?{valid:e.value===n.value,message:"'"+e.name+"' does not equal '"+n.name+"'"}:{valid:!1,message:"'"+t+"' can not be found"}},number:function(e){var n=t(e),r=isNaN(parseFloat(e.value))?!1:parseFloat(e.value),i=r!==!1?isNaN(n.attr("min"))?!1:parseFloat(n.attr("min")):r,s=r!==!1?isNaN(n.attr("max"))?!1:parseFloat(n.attr("max")):r,o=!0,u="Please enter a number";return i!==!1&&s!==!1?(o=r>=i&&r<=s,u="Please enter a number greater than or equal to "+i+" and less than or equal to "+s+"."):i!==!1?(o=r>=i,u="Please enter a number greater than or equal to "+i+"."):s!==!1&&(o=r<=s,u="Please enter a number less than or equal to "+s+"."),{valid:r!==!1&&o,message:u}},pattern:function(e){return{valid:(new RegExp(e.pattern)).test(e.value),message:"Please match the requested format."}},range:function(e){return this.number(e)},required:function(e){return{valid:t.trim(e.value).length,message:"Please fill out this field."}},text:function(){return{valid:!0}},time:function(e){return{valid:l.time.test(e.value),message:"Please enter a time in the format hh:mm:ss"}},url:function(e){return{valid:l.url.test(e.value),message:"Please enter a url."}}},h=function(e){return e instanceof jQuery&&(e=e[0]),e},p=function(){};p.prototype={getElements:function(e){return this.elements?this.elements:t(e).map(function(){return this.elements?t.makeArray(this.elements):t.makeArray(t(this).find("input, textarea, select"))}).not(a)},validateElement:function(e){if(!e)throw new Error("method requires an element");f=!0;var t=v(h(e));return f=!1,t},validateForm:function(e){var t=this.el||h(e),n;if(t.nodeName.toLowerCase()!=="form")throw new Error("you must pass a form to this method");return f=!0,n=g(this.elements||this.getElements(t)),f=!1,n}},t.fn[o]=function(e){var r=typeof e=="string",i=Array.prototype.slice.call(arguments,1),s=this,u;if(r)this.each(function(){var r;u=t.data(this,o);if(!u)throw new Error("cannot call methods on "+o+" prior to initialization; attempted to call method '"+e+"'");if(!t.isFunction(u[e]))throw new Error("no such method '"+e+"' for "+o+" widget instance");r=u[e].apply(u,i);if(r!==u&&r!==n)return s=r&&r.jquery?s.pushStack(r.get()):r,!1});else{var a;this.each(function(){u=t.data(this,o),u||(a=new p,d.call(a,this,e||{}),t.data(this,o,a))})}return s},t.fn[o].defualtOptions={event:"keydown",delay:750,insert:"before",location:"bottom",position:T,template:"<div>{{message}}</div>",theme:"none",valid:function(){return!0}},t[o]=new p,t.expr[":"][o]=function(e){return e.textContent.indexOf(o)>=0}})(this,jQuery);