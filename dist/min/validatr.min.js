/*! Validatr - v0.2.0 - 2013-02-18
* https://github.com/jaymorrow/validatr
* Copyright (c) 2013 Jay Morrow; Licensed MIT */
(function(t,e,a,i){"use strict";function r(t,e){if(this.el=t,this.$el=a(t),!this.$el.length||!this.$el.is("form"))throw Error($+" needs a form to work.");this.isSubmit=!1,this.firstError=!1,this.options=a.extend({},a.fn[$].defualtOptions,e),this.options.template=a(this.options.template).addClass(A.base+A[this.options.theme])[0].outerHTML,this.elements=this.getElements(this.el).on("valid."+$,a.proxy(p,this)).on("invalid."+$,a.proxy(c,this)),this.el.noValidate=!0,this.$el.on("submit."+$,a.proxy(m,this)),this.$el.on("reset."+$,a.proxy(f,this))}function n(){this.elements.on({"focus.validatrelement":o,"blur.validatrelement":l}),a("input[type=radio], input[type=checkbox]").on("click.validatrelement",function(t){u(t.target)})}function s(){this.elements.off(".validatrelement")}function o(t){var e=t.target,i=e;"select"===e.nodeName.toLowerCase()&&i.on("change.validatrinput",function(){setTimeout(function(){u(e)},1)}),a(e).on({"blur.validatrinput":function(){u(e)},"keyup.validatrinput":function(t){e.value.length&&-1===w(x,t.keyCode)&&u(e)}})}function l(t){a(t.target).off(".validatrinput")}function u(t){if("radio"===t.type){var i=a(e.getElementsByName(t.name)).filter("[required]");i.length&&(t=i[0])}var r=a(t),n=t.getAttribute("type"),s=v.attributes.required?t.required:a(t).is("[required]"),o={valid:!0};if(v.inputtypes[n]&&t.checkValidity){if(o.valid=t.checkValidity(),!o.valid)return!1}else s&&(o=y.required(t)),o.valid&&t.value.length&&!g.boxes.test(n)&&(t.pattern&&(n="pattern"),y[n]&&(o=y[n](t)));if(o.valid)for(var l in b)if(b.hasOwnProperty(l)&&r.is("[data-"+l+"]")&&(o=b[l](t),!o.valid))break;return o.valid?(r.trigger("valid"),!0):(a.data(t,"validationMessage",o.message),r.trigger("invalid"),!1)}function d(t){var e=!0;return t.each(function(t,a){u(a)||(e=!1)}),e}function m(){this.isSubmit=!0,f.call(this);var t=d(this.elements);return t?this.options.valid.call(this.el,this.el):(n.call(this),this.isSubmit=!1,t)}function f(){s.call(this),this.firstError=!1,this.elements.next(".validatr-message").remove()}function c(t){if(!C){t.preventDefault();var e=t.target,r=a(e),n=e.validationMessage||a.data(e,"validationMessage"),s=this.options,o=a(s.template.replace("{{message}}",n));return this.isSubmit&&!this.firstError?(this.firstError=r.after(o),s.position.call(this,o,r),i):((!this.isSubmit||s.showall)&&(p(t),r.after(o),s.position.call(this,o,r)),i)}}function p(t){a(t.target).next(".validatr-message").remove()}function h(t,e){t.css("position","absolute");var a=e.offset(),i=e.data("location")||this.options.location;g.topbottom.test(i)?(t.offset({left:a.left}),"top"===i&&t.offset({top:a.top-t.outerHeight()-2}),"bottom"===i&&t.offset({top:a.top+t.outerHeight()})):g.leftright.test(i)&&(t.offset({top:a.top+e.outerHeight()/2-t.outerHeight()/2}),"left"===i&&t.offset({left:a.left-t.outerWidth()-2}),"right"===i&&t.offset({left:a.left+e.outerWidth()+2}))}var v=function(){var t={},a=e.documentElement,r=":)",n=e.createElement("input"),s={};return t.attributes={multiple:!!("multiple"in n),required:!!("required"in n)},t.inputtypes=function(t){for(var o,l,u,d=0,m=t.length;m>d;d++)n.setAttribute("type",l=t[d]),o="text"!==n.type,o&&(n.value=r,n.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(l)&&n.style.WebkitAppearance!==i?(a.appendChild(n),u=e.defaultView,o=u.getComputedStyle&&"textfield"!==u.getComputedStyle(n,null).WebkitAppearance&&0!==n.offsetHeight,a.removeChild(n)):/^(search|tel)$/.test(l)||(o=/^(url|email)$/.test(l)?n.checkValidity&&n.checkValidity()===!1:n.value!==r)),s[t[d]]=!!o;return s.text=!0,s.password=!0,s}("search tel url email datetime date month week time datetime-local number range color".split(" ")),n=null,t}(),g={boxes:/checkbox|radio/i,color:/^#[0-9A-F]{6}$/i,date:{dd:"(0[1-9]|[12][0-9]|3[01])",mm:"(0[1-9]|1[012])",yyyy:"(\\d{4})"},email:/^[a-zA-Z0-9.!#$%&â€™*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/,isoDate:/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,leftright:/left|right/i,separators:/(\/|\-|\.)/g,separatorsNoGroup:/\/|\-|\./g,time:/^([01][0-9]|2[0-3])(:([0-5][0-9])){2}$/,topbottom:/top|bottom/i,url:/^\s*https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?\s*$/},y={checkbox:function(t){return{valid:t.checked,message:"Please check this box if you want to proceed."}},color:function(t){return{valid:g.color.test(t.value),message:"Please enter a color in the format #xxxxxx"}},date:function(t){var e=a(t),i=v.inputtypes.date?k(t.value):E(t),r=e.attr("min")?k(e.attr("min")):!1,n=e.attr("max")?k(e.attr("max")):!1,s=isNaN(e.attr("step"))?!1:parseInt(e.attr("step"),10);return q.call(t,i,r,n,s,"date")},email:function(t){var e=!0,r="Please enter an email address.",n=v.attributes.multiple?t.multiple:a(t).is("[multiple]");if(n){var s=t.value.split(",");a.each(s,function(t,a){return g.email.test(a)?i:(e=!1,r="Please enter a comma separated list of email addresses.",i)})}else e=g.email.test(t.value);return{valid:e,message:r}},number:function(t){var e=a(t),i=isNaN(parseFloat(t.value))?!1:parseFloat(t.value),r=i!==!1?isNaN(e.attr("min"))?!1:parseFloat(e.attr("min")):!1,n=i!==!1?isNaN(e.attr("max"))?!1:parseFloat(e.attr("max")):!1,s=i!==!1?isNaN(e.attr("step"))?!1:parseFloat(e.attr("step")):!1;return s!==!1&&r===!1&&(r=0),q.call(t,i,r,n,s,"number")},pattern:function(t){return{valid:RegExp(t.pattern).test(t.value),message:"Please match the requested format."}},radio:function(t){return{valid:a(e.getElementsByName(t.name)).is(":checked"),message:"Please select one of these options."}},range:function(t){return this.number(t)},required:function(t){return g.boxes.test(t.type)?this[t.type](t):{valid:t.value.length,message:"select"===t.nodeName.toLowerCase()?"Please select an item in the list.":"Please fill out this field."}},time:function(t){return{valid:g.time.test(t.value),message:"Please enter a time in the format hh:mm:ss"}},url:function(t){return{valid:g.url.test(t.value),message:"Please enter a url."}}},b={as:function(t){if("text"!==t.type)throw Error("element must have a type of text");var e=a(t).data("as");return y[e]?y[e](t):i},match:function(t){var i=a(t).data("match"),r=e.getElementById(i)||e.getElementsByName(i)[0];return r?(a(r).off("valid.validatrinput").on("valid.validatrinput",function(){t.value===r.value&&u(t)}),{valid:t.value===r.value,message:"'"+t.name+"' does not equal '"+r.name+"'"}):{valid:!1,message:"'"+i+"' can not be found"}}},x=[16,17,18,19,20,33,34,35,36,37,39],w=function(t,e){for(var a=-1,i=t?t.length:0;i>++a;)if(t[a]===e)return a;return-1},E=function(t){var e=a(t).data("format")||a[$].dateFormat,i=e.split(g.separatorsNoGroup),r=t.value.split(g.separatorsNoGroup),n="yyyy-mm-dd".split("-"),s=e.replace(g.separators,"\\$1").replace("yyyy",g.date.yyyy).replace("mm",g.date.mm).replace("dd",g.date.dd),o=-1,l=n.length,u=[];if(s=RegExp(s),!s.test(t.value))return!1;for(;l>++o;)u[o]=r[w(i,n[o])];return k(u.join("-"))},k=function(t){if(!g.isoDate.test(t))return!1;var e=g.isoDate.exec(t);return new Date(parseInt(e[1],10),parseInt(e[2],10)-1,parseInt(e[3],10))},N=function(t,e){var i=t.getDate(),r=t.getMonth()+1,n=t.getFullYear(),s=(a(e).data("format")||a[$].dateFormat).replace("mm",r).replace("yyyy",n).replace("dd",i);return s},q=function(t,e,a,i,r){var n=!0,s="Please enter a "+r,o=e,l=a;return"date"===r&&(o=e&&N(e,this),l=a&&N(a,this)),t!==!1&&(e!==!1&&a!==!1?(n=t>=e&&a>=t,s="Please enter a "+r+" greater than or equal to "+o+"<br /> and less than or equal to "+l+"."):e!==!1?(n=t>=e,s="Please enter a "+r+" greater than or equal to "+o+"."):a!==!1&&(n=a>=t,s="Please enter a "+r+" less than or equal to "+l+"."),n&&i!==!1&&(n=0===(t-e)%i,s="Invalid "+r)),{valid:t!==!1&&n,message:s}},P=function(t){return t instanceof jQuery&&(t=t[0]),t},$="validatr",A={base:$+"-message ",bootstrap:"alert alert-error",jqueryui:"ui-state-error ui-corner-all",none:$+"-error"},F="button, input[type=submit], input[type=button], input[type=reset]",C=!1,S="mm/dd/yyyy",D=function(){};D.prototype={dateFormat:S,addTest:function(t){var e="string"!=typeof t,i=Array.prototype.slice.call(arguments,1)[0];if(e)a.extend(b,t);else{if(!i)throw Error("You must include a callback function");b[t]=i}},getElements:function(t){if(this.elements)return this.elements;var e=a(t).map(function(){return this.elements?a.makeArray(this.elements):a.makeArray(a(this).find("input, textarea, select"))}).not(F);return t.id&&(e=e.add(a('[for="'+t.id+'"]'))),e},validateElement:function(t){if(!t)throw Error("method requires an element");C=!0;var e=u(P(t));return C=!1,e},validateForm:function(t){var e,a=this.el||P(t);if("form"!==a.nodeName.toLowerCase())throw Error("you must pass a form to this method");return C=!0,e=d(this.elements||this.getElements(a)),C=!1,e}},a.fn[$]=function(t){var e,n="string"==typeof t,s=Array.prototype.slice.call(arguments,1),o=this;if(n)this.each(function(){var r;if(e=a.data(this,$),!e)throw Error("cannot call methods on "+$+" prior to initialization; attempted to call method '"+t+"'");if(!a.isFunction(e[t]))throw Error("no such method '"+t+"' for "+$+" widget instance");return r=e[t].apply(e,s),r!==e&&r!==i?(o=r&&r.jquery?o.pushStack(r.get()):r,!1):i});else{var l;this.each(function(){e=a.data(this,$),e||(l=new D,r.call(l,this,t||{}),a.data(this,$,l))})}return o},a.fn[$].defualtOptions={showall:!1,location:"right",position:h,template:"<div>{{message}}</div>",theme:"none",valid:a.noop},a[$]=new D,a.expr[":"][$]=function(t){return t.textContent.indexOf($)>=0}})(this,this.document,jQuery);