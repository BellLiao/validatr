/*! Validatr - v0.1.2 - 2013-02-12
* https://github.com/jaymorrow/validatr
* Copyright (c) 2013 Jay Morrow; Licensed MIT */
(function(e,t,n,r){"use strict";function w(e,t){this.el=e,this.$el=n(e);if(!this.$el.length||!this.$el.is("form"))throw new Error(d+" needs a form to work.");this.isSubmit=!1,this.firstError=!1,this.options=n.extend({},n.fn[d].defualtOptions,t),this.options.template=n(this.options.template).addClass(v.base+v[this.options.theme])[0].outerHTML,this.elements=this.getElements(this.el).on("valid."+d,n.proxy(M,this)).on("invalid."+d,n.proxy(O,this)),this.el.noValidate=!0,this.$el.on("submit."+d,n.proxy(k,this)),this.$el.on("reset."+d,n.proxy(L,this))}function E(){this.elements.on({"focus.validatrelement":x,"blur.validatrelement":T}),n("input[type=radio]").on("click.validatrelement",function(e){N(e.target)})}function S(){this.elements.off(".validatrelement")}function x(e){var t=e.target;n(t).on({"change.validatrinput":function(){setTimeout(function(){N(t)},1)},"blur.validatrinput":function(){N(t)},"keyup.validatrinput":function(){t.value.length&&N(t)}})}function T(e){n(e.target).off(".validatrinput")}function N(e){if(e.type==="radio"){var r=n(t.getElementsByName(e.name)).filter("[required]");r.length&&(e=r[0])}var a=n(e),f=e.getAttribute("type"),l=i.required?e.required:A(e),c={valid:!0};if(i.inputtypes[f]&&e.checkValidity){c.valid=e.checkValidity();if(!c.valid)return!1}else l&&(c=o.required(e)),c.valid&&e.value.length&&!s.boxes.test(f)&&(e.pattern&&(f="pattern"),o[f]&&(c=o[f](e)));if(c.valid)for(var h in u)if(u.hasOwnProperty(h)&&a.data(h)){c=u[h](e);if(!c.valid)break}return c.valid?(a.trigger("valid"),!0):(n.data(e,"validationMessage",c.message),a.trigger("invalid"),!1)}function C(e){var t=!0;return e.each(function(e,n){N(n)||(t=!1)}),t}function k(){this.isSubmit=!0,L.call(this);var e=C(this.elements);return e?this.options.valid.call(this.el,this.el):(E.call(this),this.isSubmit=!1,e)}function L(){S.call(this),this.firstError=!1,this.$el.find(".validatr-message").remove()}function A(e){if(e.required)return e.required==="true";var t=e.attributes,n=t.length,r=0;for(r;r<n;r+=1)if(t[r].name==="required")return e.required="true",!0;return e.required="false",!1}function O(e){if(g)return;e.preventDefault();var t=e.target,r=n(t),i=t.validationMessage||n.data(t,"validationMessage"),s=this.options,o=n(s.template.replace("{{message}}",i));if(this.isSubmit&&!this.firstError){this.firstError=r.after(o),s.position.call(this,o,r);return}if(!this.isSubmit||s.showall)M(e),r.after(o),s.position.call(this,o,r)}function M(e){n(e.target).next(".validatr-message").remove()}function _(e,t){e.css("position","absolute");var n=t.offset(),r=t.data("location")||this.options.location;s.topbottom.test(r)?(e.offset({left:n.left}),r==="top"&&e.offset({top:n.top-e.outerHeight()-2}),r==="bottom"&&e.offset({top:n.top+e.outerHeight()})):s.leftright.test(r)&&(e.offset({top:n.top+t.outerHeight()/2-e.outerHeight()/2}),r==="left"&&e.offset({left:n.left-e.outerWidth()-2}),r==="right"&&e.offset({left:n.left+t.outerWidth()+2}))}var i=function(){var e={},n=t.documentElement,i=":)",s=t.createElement("input"),o={};return e.required="required"in s,e.inputtypes=function(e){for(var u=0,a,f,l,c=e.length;u<c;u++)s.setAttribute("type",f=e[u]),a=s.type!=="text",a&&(s.value=i,s.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&s.style.WebkitAppearance!==r?(n.appendChild(s),l=t.defaultView,a=l.getComputedStyle&&l.getComputedStyle(s,null).WebkitAppearance!=="textfield"&&s.offsetHeight!==0,n.removeChild(s)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?a=s.checkValidity&&s.checkValidity()===!1:a=s.value!==i)),o[e[u]]=!!a;return o.text=!0,o.password=!0,o}("search tel url email datetime date month week time datetime-local number range color".split(" ")),s=null,e}(),s={boxes:/checkbox|radio/i,color:/^#[0-9A-F]{6}$/i,date:{dd:"(0[1-9]|[12][0-9]|3[01])",mm:"(0[1-9]|1[012])",yy:"(\\d{4})"},email:/^[a-zA-Z0-9.!#$%&â€™*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/,isoDate:/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,leftright:/left|right/i,separators:/(\/|\-|\.)/g,separatorsNoGroup:/\/|\-|\./g,time:/^([01][0-9]|2[0-3])(:([0-5][0-9])){2}$/,topbottom:/top|bottom/i,url:/^\s*https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?\s*$/},o={checkbox:function(e){return{valid:e.checked,message:"Please check this box if you want to proceed."}},color:function(e){return{valid:s.color.test(e.value),message:"Please enter a color in the format #xxxxxx"}},date:function(e){var t=n(e),r=i.inputtypes.date?l(e.value):f(e),s=t.attr("min")?l(t.attr("min")):!1,o=t.attr("max")?l(t.attr("max")):!1,u=isNaN(t.attr("step"))?!1:parseInt(t.attr("step"),10);return h.call(e,r,s,o,u,"date")},email:function(e){var t=!0,r="Please enter an email address.";if(e.multiple){var i=e.value.split(",");n.each(i,function(e,n){if(!s.email.test(n)){t=!1,r="Please enter a comma separated list of email addresses.";return}})}else t=s.email.test(e.value);return{valid:t,message:r}},number:function(e){var t=n(e),r=isNaN(parseFloat(e.value))?!1:parseFloat(e.value),i=r!==!1?isNaN(t.attr("min"))?!1:parseFloat(t.attr("min")):!1,s=r!==!1?isNaN(t.attr("max"))?!1:parseFloat(t.attr("max")):!1,o=r!==!1?isNaN(t.attr("step"))?!1:parseFloat(t.attr("step")):!1;return o!==!1&&i===!1&&(i=0),h.call(e,r,i,s,o,"number")},pattern:function(e){return{valid:(new RegExp(e.pattern)).test(e.value),message:"Please match the requested format."}},radio:function(e){return{valid:n(t.getElementsByName(e.name)).is(":checked"),message:"Please select one of these options."}},range:function(e){return this.number(e)},required:function(e){return s.boxes.test(e.type)?this[e.type](e):{valid:e.value.length,message:e.nodeName.toLowerCase()==="select"?"Please select an item in the list.":"Please fill out this field."}},time:function(e){return{valid:s.time.test(e.value),message:"Please enter a time in the format hh:mm:ss"}},url:function(e){return{valid:s.url.test(e.value),message:"Please enter a url."}}},u={as:function(e){if(e.type!=="text")throw new Error("element must have a type of text");var t=n(e).data("as");if(o[t])return o[t](e)},match:function(e){var r=n(e).data("match"),i=t.getElementById(r)||t.getElementsByName(r)[0];return i?(n(i).off("valid.validatrinput").on("valid.validatrinput",function(){e.value===i.value&&N(e)}),{valid:e.value===i.value,message:"'"+e.name+"' does not equal '"+i.name+"'"}):{valid:!1,message:"'"+r+"' can not be found"}}},a=function(e,t){var n=-1,r=e?e.length:0;while(++n<r)if(e[n]===t)return n;return-1},f=function(e){var t=n(e).data("format")||y,r=t.split(s.separatorsNoGroup),i=e.value.split(s.separatorsNoGroup),o="yy-mm-dd".split("-"),u=t.replace(s.separators,"\\$1").replace("yy",s.date.yy).replace("mm",s.date.mm).replace("dd",s.date.dd),f=-1,c=o.length,h=[];u=new RegExp(u);if(!u.test(e.value))return!1;while(++f<c)h[f]=i[a(r,o[f])];return l(h.join("-"))},l=function(e){if(!s.isoDate.test(e))return!1;var t=s.isoDate.exec(e);return new Date(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10))},c=function(e,t){var r=e.getDate(),i=e.getMonth()+1,s=e.getFullYear(),o=(n(t).data("format")||y).replace("mm",i).replace("yy",s).replace("dd",r);return o},h=function(e,t,n,r,i){var s=!0,o="Please enter a "+i,u=t,a=n;return i==="date"&&(u=c(t,this),a=c(n,this)),e!==!1&&(t!==!1&&n!==!1?(s=e>=t&&e<=n,o="Please enter a "+i+" greater than or equal to "+u+"<br /> and less than or equal to "+a+"."):t!==!1?(s=e>=t,o="Please enter a "+i+" greater than or equal to "+u+"."):n!==!1&&(s=e<=n,o="Please enter a "+i+" less than or equal to "+a+"."),s&&r!==!1&&(s=(e-t)%r===0,o="Invalid "+i)),{valid:e!==!1&&s,message:o}},p=function(e){return e instanceof jQuery&&(e=e[0]),e},d="validatr",v={base:d+"-message ",bootstrap:"alert alert-error",jqueryui:"ui-state-error ui-corner-all",none:d+"-error"},m="button, input[type=submit], input[type=button], input[type=reset]",g=!1,y="mm/dd/yy",b=function(){};b.prototype={addTest:function(e){var t=typeof e!="string",r=Array.prototype.slice.call(arguments,1)[0];t?n.extend(u,e):u[e]=r},getElements:function(e){return this.elements?this.elements:n(e).map(function(){return this.elements?n.makeArray(this.elements):n.makeArray(n(this).find("input, textarea, select"))}).not(m)},validateElement:function(e){if(!e)throw new Error("method requires an element");g=!0;var t=N(p(e));return g=!1,t},validateForm:function(e){var t=this.el||p(e),n;if(t.nodeName.toLowerCase()!=="form")throw new Error("you must pass a form to this method");return g=!0,n=C(this.elements||this.getElements(t)),g=!1,n}},n.fn[d]=function(e){var t=typeof e=="string",i=Array.prototype.slice.call(arguments,1),s=this,o;if(t)this.each(function(){var t;o=n.data(this,d);if(!o)throw new Error("cannot call methods on "+d+" prior to initialization; attempted to call method '"+e+"'");if(!n.isFunction(o[e]))throw new Error("no such method '"+e+"' for "+d+" widget instance");t=o[e].apply(o,i);if(t!==o&&t!==r)return s=t&&t.jquery?s.pushStack(t.get()):t,!1});else{var u;this.each(function(){o=n.data(this,d),o||(u=new b,w.call(u,this,e||{}),n.data(this,d,u))})}return s},n.fn[d].defualtOptions={showall:!1,location:"right",position:_,template:"<div>{{message}}</div>",theme:"none",valid:n.noop},n[d]=new b,n.expr[":"][d]=function(e){return e.textContent.indexOf(d)>=0}})(this,this.document,jQuery);